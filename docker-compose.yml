version: '3.8'

services:
  # --------------------
  # 1. Frontend Service (Vue 3 / NGINX)
  # --------------------
  frontend:
    container_name: meetro_frontend
    build:
      context: ./frontend
      dockerfile: Dockerfile
    # Maps container port 80 to host port 8080 (allows external access from your browser)
    ports:
      - "8080:80"
    depends_on:
      - backend

  # --------------------
  # 2. Backend Service (FastAPI)
  # --------------------
  backend:
    container_name: meetro_backend
    build:
      context: ./backend
      dockerfile: Dockerfile
    # Exposes port 5000 internally for the frontend to access
    expose:
      - "5000"
    # Mount local backend code for development hot-reloading
    volumes:
      - ./backend:/app
    environment:
      PYTHONUNBUFFERED: 1
      # Note: Database credentials should eventually be secured!
      DATABASE_HOST: db
      DATABASE_NAME: meetro_dev_db
      DATABASE_USER: meetro_user
      DATABASE_PASS: supersecurepassword # Replace this with a real password

  # --------------------
  # 3. Database Service (PostgreSQL)
  # --------------------
  db:
    container_name: meetro_db
    image: postgres:15-alpine
    restart: always
    environment:
      POSTGRES_USER: meetro_user
      POSTGRES_PASSWORD: supersecurepassword # Match the backend's DATABASE_PASS
      POSTGRES_DB: meetro_dev_db
    # Exposes port 5432 internally for the backend to connect
    expose:
      - "5432"
    # Persist the data outside the container
    volumes:
      - meetro_postgres_data:/var/lib/postgresql/data/

# Define the persistent volume for the database
volumes:
  meetro_postgres_data: