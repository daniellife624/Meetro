version: '3.8'

services:
  backend:
    container_name: meetro_backend
    build:
      context: .
      dockerfile: backend/Dockerfile
    ports:
      # å¾Œç«¯ API ç«¯å£æ˜ å°„
      - "8000:8000"
    volumes:
      # æ˜ å°„å¾Œç«¯åŸå§‹ç¢¼ä»¥å•Ÿç”¨å¯¦æ™‚æ›´æ–° (å¦‚æœæ‚¨çš„å¾Œç«¯æ”¯æŒ)
      - ./backend:/app

  frontend:
    container_name: meetro_frontend
    # é€™æ˜¯å°ˆç‚ºé–‹ç™¼ç’°å¢ƒé…ç½®çš„å‰ç«¯æœå‹™ï¼Œä½¿ç”¨ Vite é€²è¡Œç†±é‡è¼‰ (HMR)
    build:
      context: ./frontend
      # ğŸ¯ ç¢ºä¿ä½¿ç”¨åŒ…å« Node.js å’Œ npm çš„é–‹ç™¼ç’°å¢ƒ Dockerfile
      dockerfile: Dockerfile.dev 
    
    ports:
      # ã€ä¿®æ­£ 1ã€‘çµ±ä¸€ç«¯å£æ˜ å°„ï¼šå°‡ä¸»æ©Ÿçš„ 8080 ç«¯å£æ˜ å°„åˆ°å®¹å™¨å…§ Vite çš„ 8080 ç«¯å£ã€‚
      - "8080:8080" 
    
    volumes:
      # 1. æ˜ å°„å‰ç«¯åŸå§‹ç¢¼åˆ°å®¹å™¨ /appï¼Œå•Ÿç”¨å¯¦æ™‚ç†±é‡è¼‰ (HMR)ã€‚
      - ./frontend:/app 
      # 2. æ’é™¤ node_modulesï¼šç¢ºä¿å®¹å™¨ä½¿ç”¨å…¶å…§å®‰è£çš„ä¾è³´ã€‚
      - /app/node_modules 
      
    # ã€ä¿®æ­£ 2ã€‘åŸ·è¡Œ Vite é–‹ç™¼ä¼ºæœå™¨ï¼Œä¸¦ç¶å®šåˆ° 0.0.0.0 ä¸”ä½¿ç”¨ 8080 ç«¯å£ã€‚
    command: npm run dev -- --host 0.0.0.0 --port 8080
      
    depends_on:
      - backend