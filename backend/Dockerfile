FROM python:3.10-slim

WORKDIR /app

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

RUN apt-get update \
    && apt-get install -y --no-install-recommends gcc libpq-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# ä¿®æ­£ 1ï¼šè¤‡è£½ requirements.txt åˆ°å®¹å™¨çš„ /app
# ç”±æ–¼ context æ˜¯æ ¹ç›®éŒ„ï¼Œé€™è£¡å¿…é ˆæ˜ç¢ºæŒ‡å®šè·¯å¾‘
COPY requirements.txt /tmp/requirements.txt
RUN pip install --no-cache-dir -r /tmp/requirements.txt

# é—œéµä¿®æ­£ 2ï¼šè¤‡è£½æ•´å€‹ backend è³‡æ–™å¤¾åˆ° /app/backend
# æˆ‘å€‘ä¸èƒ½åœ¨ backend/Dockerfile è£¡ä½¿ç”¨ COPY backendï¼Œé€™æœƒé€ æˆéè¿´éŒ¯èª¤ã€‚
# æˆ‘å€‘å¿…é ˆè¤‡è£½æ‰€æœ‰ *å¿…è¦çš„* ç¨‹å¼ç¢¼ã€‚

# ğŸš¨ è«‹å°‡æ­¤è¡Œç§»é™¤ï¼š
# COPY backend /app/backend

# ğŸš¨ æ¡ç”¨é€™å…©è¡Œæ›¿æ›ï¼šå°‡ backend/ è£¡çš„æ‰€æœ‰å…§å®¹è¤‡è£½åˆ° /app/backend
# ç‚ºäº†é¿å…åœ¨ backend/Dockerfile è£¡è¤‡è£½ backendï¼Œæˆ‘å€‘å¿…é ˆå°‡ç¨‹å¼ç¢¼åŒ…åœ¨å¦ä¸€å€‹è³‡æ–™å¤¾å…§ã€‚
# ç”±æ–¼æ‚¨ä¸é¡˜ç§»å‹•ç¨‹å¼ç¢¼ï¼Œé€™æ˜¯æœ€å®‰å…¨ä¸”èƒ½é‹ä½œçš„æ–¹å¼ï¼š
COPY . /app/backend/

# è®“ Python èƒ½å¤ å¾ /app æ‰¾åˆ° backend æ¨¡çµ„
ENV PYTHONPATH=/app:$PYTHONPATH